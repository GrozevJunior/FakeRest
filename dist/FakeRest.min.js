!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):"object"==typeof exports?exports.FakeRest=t():e.FakeRest=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=r(o),s=n(2),u=r(s);t["default"]={Server:i["default"],Collection:u["default"]},e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=e[Symbol.iterator]();!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(a){o=!0,i=a}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){if(!e)return{};var t={},n=e.split("&");return n.map(function(e){if(-1===e.indexOf("="))t[e]=!0;else{var n=e.split("="),r=o(n,2),i=r[0],s=r[1];(0===s.indexOf("[")||0===s.indexOf("{"))&&(s=JSON.parse(s)),t[i.trim()]=s}}),t}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2),l=r(a),c=function(){function e(){var t=void 0===arguments[0]?"":arguments[0];i(this,e),this.baseUrl=t,this.collections={},this.loggingEnabled=!1,this.requestInterceptors=[],this.responseInterceptors=[]}return u(e,[{key:"init",value:function(e){for(var t in e)this.addCollection(t,new l["default"](e[t]))}},{key:"toggleLogging",value:function(){this.loggingEnabled=!this.loggingEnabled}},{key:"addCollection",value:function(e,t){this.collections[e]=t}},{key:"getCollection",value:function(e){return this.collections[e]}},{key:"getCollectionNames",value:function(){return Object.keys(this.collections)}},{key:"addRequestInterceptor",value:function(e){this.requestInterceptors.push(e)}},{key:"addResponseInterceptor",value:function(e){this.responseInterceptors.push(e)}},{key:"getCount",value:function(e,t){return this.collections[e].getCount(t)}},{key:"getAll",value:function(e,t){return this.collections[e].getAll(t)}},{key:"getOne",value:function(e,t){return this.collections[e].getOne(t)}},{key:"addOne",value:function(e,t){return this.collections[e].addOne(t)}},{key:"updateOne",value:function(e,t,n){return this.collections[e].updateOne(t,n)}},{key:"removeOne",value:function(e,t){return this.collections[e].removeOne(t)}},{key:"decode",value:function(e){if(e.queryString=decodeURIComponent(e.url.slice(e.url.indexOf("?")+1)),e.params=s(e.queryString),e.requestBody)try{e.json=JSON.parse(e.requestBody)}catch(t){}return this.requestInterceptors.reduce(function(e,t){return t(e)},e)}},{key:"respond",value:function(e,t,n){var r=void 0===arguments[3]?200:arguments[3];t||(t={}),t["Content-Type"]||(t["Content-Type"]="application/json");var o={status:r,headers:t,body:e};return o=this.responseInterceptors.reduce(function(e,t){return t(e)},o),this.log(n,o),n.respond(o.status,o.headers,JSON.stringify(o.body))}},{key:"log",value:function(e,t){this.loggingEnabled&&(console.group?(console.groupCollapsed(e.method,e.url,"(FakeRest)"),console.group("request"),console.log(e.method,e.url),console.log("headers",e.requestHeaders),console.log("body   ",e.requestBody),console.groupEnd(),console.group("response",t.status),console.log("headers",t.headers),console.log("body   ",t.body),console.groupEnd(),console.groupEnd()):(console.log("FakeRest request ",e.method,e.url,"headers",e.requestHeaders,"body",e.requestBody),console.log("FakeRest response",t.status,"headers",t.headers,"body",t.body)))}},{key:"handle",value:function(e){e=this.decode(e);var t=!0,n=!1,r=void 0;try{for(var o,i=this.getCollectionNames()[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var s=o.value,u=e.url.match(new RegExp("^"+this.baseUrl+"\\/("+s+")(\\/(\\d+))?(\\?.*)?$"));if(u)if(u[2]){var a=u[3];if("GET"==e.method)try{var l=this.getOne(s,a);return this.respond(l,null,e)}catch(c){return e.respond(404)}if("PUT"==e.method)try{var l=this.updateOne(s,a,e.json);return this.respond(l,null,e)}catch(c){return e.respond(404)}if("DELETE"==e.method)try{var l=this.removeOne(s,a);return this.respond(l,null,e)}catch(c){return e.respond(404)}}else{if("GET"==e.method){var f=e.params,d={};for(var h in f)"range"!==h&&(d[h]=f[h]);var p=this.getCount(s,d),y=void 0,v=void 0,g=void 0;if(p>0){y=this.getAll(s,f);var m=f.range?f.range[0]:0,b=f.range?Math.min(y.length-1+m,f.range[1]):y.length-1;v="items "+m+"-"+b+"/"+p,g=y.length==p?200:206}else y=[],v="items */0",g=200;return this.respond(y,{"Content-Range":v},e,g)}if("POST"==e.method){var w=this.addOne(s,e.json),O=this.baseUrl+"/"+s+"/"+w[this.getCollection(s).identifierName];return this.respond(w,{Location:O},e,201)}}}}catch(k){n=!0,r=k}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw r}}}},{key:"getHandler",value:function(){return this.handle.bind(this)}}]),e}();t["default"]=c,e.exports=t["default"]},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if("function"==typeof t)return e.filter(t);if(t instanceof Object)return e.filter(function(e){for(var n in t)if(e[n]!=t[n])return!1;return!0});throw new Error("Unsupported filter type")}function i(e,t){if("function"==typeof t)return e.sort(t);if("string"==typeof t)return e.sort(function(e,n){return e[t]>n[t]?1:e[t]<n[t]?-1:0});if(Array.isArray(t)){var n=function(){var n=t[0],r="asc"==t[1].toLowerCase()?1:-1;return{v:e.sort(function(e,t){return e[n]>t[n]?r:e[n]<t[n]?-1*r:0})}}();if("object"==typeof n)return n.v}throw new Error("Unsupported sort type")}function s(e,t){if(Array.isArray(t))return e.slice(t[0],void 0!==t[1]?t[1]+1:void 0);throw new Error("Unsupported range type")}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(3);var a=function(){function e(){var t=void 0===arguments[0]?[]:arguments[0],n=void 0===arguments[1]?"id":arguments[1];if(r(this,e),!Array.isArray(t))throw new Error("Can't initialize a Collection with anything else than an array of items");this.sequence=0,this.identifierName=n,this.items=[],t.map(this.addOne.bind(this))}return u(e,[{key:"getCount",value:function(e){return this.getAll(e).length}},{key:"getAll",value:function(e){var t=this.items.map(function(e){return e});return e&&(e.filter&&(t=o(t,e.filter)),e.sort&&(t=i(t,e.sort)),e.range&&(t=s(t,e.range))),t}},{key:"getIndex",value:function(e){var t=this;return this.items.findIndex(function(n){return n[t.identifierName]==e})}},{key:"getOne",value:function(e){var t=this.getIndex(e);if(-1===t)throw new Error("No item with identifier "+e);return this.items[t]}},{key:"addOne",value:function(e){var t=e[this.identifierName];if(void 0!==t){if(-1!==this.getIndex(t))throw new Error("An item with the identifier "+t+" already exists");this.sequence=Math.max(this.sequence,t)+1}else e[this.identifierName]=this.sequence++;return this.items.push(e),e}},{key:"updateOne",value:function(e,t){var n=this.getIndex(e);if(-1===n)throw new Error("No item with identifier "+e);for(var r in t)this.items[n][r]=t[r];return this.items[n]}},{key:"removeOne",value:function(e){var t=this.getIndex(e);if(-1===t)throw new Error("No item with identifier "+e);var n=this.items[t];return this.items.splice(t,1),e==this.sequence-1&&this.sequence--,n}}]),e}();t["default"]=a,e.exports=t["default"]},function(e,t,n){!function(e){if(!Array.prototype.findIndex){var t=function(e){var t=Object(this),n=Math.max(0,t.length)>>>0;if(0===n)return-1;if("function"!=typeof e||"[object Function]"!==Object.prototype.toString.call(e))throw new TypeError("Array#findIndex: predicate must be a function");for(var r=arguments.length>1?arguments[1]:void 0,o=0;n>o;o++)if(e.call(r,t[o],o,t))return o;return-1};if(Object.defineProperty)try{Object.defineProperty(Array.prototype,"findIndex",{value:t,configurable:!0,writable:!0})}catch(n){}Array.prototype.findIndex||(Array.prototype.findIndex=t)}}(this)}])});